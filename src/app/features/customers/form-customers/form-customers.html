<div class="form-card">
  <div class="form-card-header">
    <div class="header-icon">
      <i class="fa fa-user-plus"></i>
    </div>
    <div>
      <h5 class="header-title">Nouveau Client</h5>
      <p class="header-subtitle">Remplissez les informations</p>
    </div>
  </div>

  <div class="form-card-body">
    <form [formGroup]="newCustomerForm" (ngSubmit)="onSubmit()" name="createForm">

      <!-- Nom -->
      <div class="field-group" [class.has-error]="isValidTouchedOrDirty('name')">
        <label class="field-label">
          <i class="fa fa-user"></i>
        </label>
        <input type="text" class="field-input" id="name" name="name"
               formControlName="name" placeholder="Nom complet du client"/>
        @if (isValidTouchedOrDirty('name')) {
          @if (fieldHasError('name', 'required')) {
            <div class="field-error-msg">
              <i class="fa fa-exclamation-circle"></i> Le nom est obligatoire
            </div>
          }
        }
      </div>

      <!-- Email -->
      <div class="field-group mt-3" [class.has-error]="isValidTouchedOrDirty('email')">
        <label class="field-label">
          <i class="fa fa-envelope"></i>
        </label>
        <div class="input-wrapper">
          <input type="text" class="field-input" id="email" name="email"
                 formControlName="email" placeholder="Email du client"/>
          <span class="input-status">
            @if (newCustomerForm.get('email')?.pending) {
              <i class="fa fa-spinner fa-spin text-primary"></i>
            }
            @if (newCustomerForm.get('email')?.valid && newCustomerForm.get('email')?.dirty) {
              <i class="fa fa-check-circle" style="color: #22c55e;"></i>
            }
          </span>
        </div>
        @if (newCustomerForm.get('email')?.pending) {
          <div class="field-checking">
            <i class="fa fa-spinner fa-spin"></i> Vérification en cours...
          </div>
        }
        @if (isValidTouchedOrDirty('email')) {
          @if (fieldHasError('email', 'required')) {
            <div class="field-error-msg"><i class="fa fa-exclamation-circle"></i> L'email est obligatoire</div>
          }
          @if (fieldHasError('email', 'email')) {
            <div class="field-error-msg"><i class="fa fa-exclamation-circle"></i> Format invalide</div>
          }
          @if (fieldHasError('email', 'CONFLICT')) {
            <div class="field-error-msg">
              <i class="fa fa-exclamation-circle"></i> {{ newCustomerForm.get('email')?.errors?.['CONFLICT'] }}
            </div>
          }
          @if (fieldHasError('email', 'EMAIL_EXIST')) {
            <div class="field-error-msg"><i class="fa fa-exclamation-circle"></i> Email déjà enregistré</div>
          }
        }
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="newCustomerForm.reset()">
          <i class="fa fa-times"></i> Annuler
        </button>
        <button type="submit" class="btn-submit"
                [disabled]="newCustomerForm.invalid || newCustomerForm.pending">
          @if (newCustomerForm.pending) {
            <i class="fa fa-spinner fa-spin"></i> Vérification...
          } @else {
            <i class="fa fa-plus"></i> Enregistrer
          }
        </button>
      </div>

    </form>
  </div>
</div>
